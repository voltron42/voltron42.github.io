<html>
    <head>
        <title>Simon</title>
        <style type="text/css">
            body {
                background-color: black;
            }
            #green.active {
                fill: lightgreen;
            }
            #red.active {
                fill: #ffcccb;
            }
            #yellow.active {
                fill: lightyellow;
            }
            #blue.active {
                fill: lightblue;
            }
        </style>
        <script type="text/javascript">
            (function(){
                let Beeper = function({type, volume}) {
                    let makeBeeper = function({frequency,callback}) {
                        let audioCtx = new (window.AudioContext || window.webkitAudioContext || window.audioContext);
                        let oscillator = audioCtx.createOscillator();
                        let gainNode = audioCtx.createGain();
                        oscillator.connect(gainNode);
                        gainNode.connect(audioCtx.destination);
                        if (volume){gainNode.gain.value = volume;}
                        if (type){oscillator.type = type;}
                        if (frequency){oscillator.frequency.value = frequency;}
                        if (callback){oscillator.onended = callback;}
                        return oscillator;
                    }
                    this.startBeep = function(args) {
                        let oscillator = makeBeeper(args);
                        oscillator.start();
                        return function() {
                            oscillator.stop();
                        }
                    }
                    this.beep = function(args){
                        let oscillator = makeBeeper(args);
                        oscillator.start(audioCtx.currentTime);
                        oscillator.stop(audioCtx.currentTime + ((args.duration || 500) / 1000));
                    }
                }
                let colors ={"green":415,"red":310,"yellow":252,"blue":209};
                window.init = function() {
                    let beeper = new Beeper({type:"sine",volume:""})
                    let gameState = {
                        status: "turn"
                    };
                    let select = function(color,rect,link) {
                        if (gameState.status === "turn") {
                            gameState.stopBeep = beeper.startBeep(colors[color]);
                            rect.classList.add("active");
                            console.log("activate "+color);
                        }
                    }
                    let deselect = function(color,rect,link) {
                        if (gameState.status === "turn") {
                            rect.classList.remove("active");
                            console.log("deactivate "+color);
                            gameState.stopBeep();
                        }
                    }
                    Object.keys(colors).forEach((colorName) => {
                        let linkId = colorName + "Link";
                        let linkElement = document.getElementById(linkId);
                        let rect = document.getElementById(colorName);
                        linkElement.addEventListener("mousedown", () => { select(colorName,rect,linkElement); });
                        linkElement.addEventListener("mouseup", () => { deselect(colorName,rect,linkElement); });
                    });
                }
            })()
        </script>
    </head>
    <body onload="init()">
        <svg width="100%" height="100%" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid slice">
            <a id="greenLink" href="#" onclick="event.preventDefault()">
                <rect id="green" x="1" y="1" width="48" height="48" fill="green"/>
            </a>
            <a id="redLink" href="#" onclick="event.preventDefault()">
                <rect id="red" x="51" y="1" width="48" height="48" fill="red"/>
            </a>
            <a id="yellowLink" href="#" onclick="event.preventDefault()">
                <rect id="yellow" x="1" y="51" width="48" height="48" fill="yellow"/>
            </a>
            <a id="blueLink" href="#" onclick="event.preventDefault()">
                <rect id="blue" x="51" y="51" width="48" height="48" fill="blue"/>
            </a>
        </svg>
    </body>
</html>